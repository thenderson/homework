	<body>
		<div class="container-fluid nopadding">
			<div class="col-sm-12"><h3><strong>YOUR COMMITMENTS</strong></h3></div>
		</div>
		
		<div class="container-fluid">
			<!--
			<table>
				<tr>
					<td class="col-sm-5 nopadding">
						<ul class="nav nav-pills">
							<li role="presentation" id="pill-0"><a href="javascript:load_user_comms(0);">Just Overdue</a></li>
							<li role="presentation" id="pill-7"><a href="javascript:load_user_comms(7);">Due This Week</a></li>
							<li role="presentation" id="pill-lookahead" class="dropdown">
								<a id="pill-drop" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Lookahead<span class="caret"></span></a>
								<ul class="dropdown-menu" role="menu">
									<li><a href="javascript:load_user_comms(14);">2 weeks</li>
									<li><a href="javascript:load_user_comms(21);">3 weeks</a></li>
									<li><a href="javascript:load_user_comms(42);">6 weeks</a></li>
									<li><a href="javascript:load_user_comms('all');">all</a></li>
									<li role="presentation" class="divider"></li>
									<li id="show_closed_toggle"><a href="javascript:load_user_comms(undefined, undefined);">---</a></li>
								</ul>
							</li>
						</ul>
					</td>
					<td class="col-sm-1 add_commitment">
						<button id="new_com_btn" type="button" class="btn btn-default btn-sm">New Commitment</button>
					</td>
					<td class="col-sm-2 filter nopadding">
						<div class="input-group">
							<div class="input-group-addon"><i class='fa fa-filter'></i></div>
							<input class="form-control input-sm" type="text" id="filter_all" name="filter"/>
						</div>
					</td>
					<td class="col-sm-4"></td>
				</tr>
			</table>
			-->
			
			<form class='form-inline'>
				<div class="form-group"><button id="new_com_btn" type="button" class="btn btn-default btn-sm">new commitment</button></div>
				<div class="form-group spacer">&nbsp;&nbsp;|&nbsp;&nbsp;</div>
				<div class="form-group horizon-slider" id="comm-horizon-slider"></div>
				<div class="form-group" id="comm-horizon-text">&nbsp;lookahead</div>
				<div class="form-group spacer">&nbsp;&nbsp;|&nbsp;&nbsp;</div>
				<div class="checkbox">
					<label>
						<input id="hide-closed" type="checkbox">hide closed
					</label>
				</div>
				<div class="form-group spacer">&nbsp;&nbsp;|&nbsp;&nbsp;</div>
				<div class="input-group input-group-filter">
					<div class="input-group-addon"><i class='fa fa-filter'></i></div>
					<input class="form-control input-sm" type="text" id="filter_all" name="filter"/>
				</div>
			</form>

			<div id="commitments">
				<div class="col-sm-12"><br><br><br><i class='fa fa-spinner fa-spin fa-2x text-center'></i><br><br><br></div>
			</div>
			
			<form class='form-inline'>
				<div class="form-group" id="com_total">total: <i class='fa fa-spinner fa-spin'></i></div>
				<div class="form-group spacer">&nbsp;&nbsp;|&nbsp;&nbsp;page size:&nbsp;</div>
				<div class="form-group">
					<div class="controls">
						<select class="input-sm" id="com_page_size" onchange="commitments.grid.setPageSize(this.value)">
							<option value=5>5</option>
							<option value=10 selected>10</option>
							<option value=25>25</option>
							<option value=50>50</option>
							<option value=0>all</option>
						</select>
					</div>
				</div>
				<div class="form-group spacer">&nbsp;&nbsp;|&nbsp;&nbsp;</div>
				<div class="form-group paginator" id="paginator"></div>
			</form>
		</div>
		<br>
		
		<div class="container-fluid nopadding">
			<div class="col-sm-12"><h3><strong>YOUR REQUESTS</strong></h3></div>
		</div>
		
		<div class="container-fluid">
			<table>
				<tr>
					<td class="col-sm-2 filter nopadding">
						<div class="input-group">
							<div class="input-group-addon"><i class='fa fa-filter'></i></div>
							<input class="form-control input-sm" type="text" id="filter_all_req" name="filter"/>
						</div>
					</td>
					<td class="col-sm-10"></td>
				</tr>
			</table>

			<div id="requests">
				<div class="col-sm-12"><br><br><br><i class='fa fa-spinner fa-spin fa-2x text-center'></i><br><br><br></div>
			</div>
			
			<form class='form-inline'>
				<div class="form-group" id="req_total">total: <i class='fa fa-spinner fa-spin'></i></div>
				<div class="form-group spacer">&nbsp;&nbsp;|&nbsp;&nbsp;page size:&nbsp;</div>
				<div class="form-group">
					<div class="controls">
						<select class="input-sm" id="req_page_size" onchange="requests.setPageSize(this.value)">
							<option value=5>5</option>
							<option value=10 selected>10</option>
							<option value=25>25</option>
							<option value=50>50</option>
							<option value=0>all</option>
						</select>
					</div>
				</div>
				<div class="form-group spacer">&nbsp;&nbsp;|&nbsp;&nbsp;</div>
				<div class="form-group paginator" id="req_paginator"></div>
			</form>
		</div>
		<br>

		<div class="container-fluid">
			<div class="nopadding"><h3><strong>PROJECTS</strong></h3></div>
			
			<table>
				<tr>
					<td class="col-sm-2 filter nopadding">
						<div class="input-group">
							<div class="input-group-addon"><i class='fa fa-filter'></i></div>
							<input class="form-control input-sm" type="text" id="filter_all_proj" name="filter"/>
						</div>
					</td>
					<td class="col-sm-10"></td>
				</tr>
			</table>
			
			<div id="user_projects">
				<br><br><br><i class='fa fa-spinner fa-spin text-center'></i>
			</div>
			
			<form class='form-inline'>
				<div class="form-group" id="proj_total">total: <i class='fa fa-spinner fa-spin'></i></div>
				<div class="form-group spacer">&nbsp;&nbsp;|&nbsp;&nbsp;page size:&nbsp;</div>
				<div class="form-group">
					<div class="controls">
						<select class="input-sm" id="proj_page_size" onchange="projects.setPageSize(this.value)">
							<option value=5 selected>5</option>
							<option value=10>10</option>
							<option value=25>25</option>
							<option value=50>50</option>
							<option value=0>all</option>
						</select>
					</div>
				</div>
				<div class="form-group spacer">&nbsp;&nbsp;|&nbsp;&nbsp;</div>
				<div class="form-group paginator" id="projects_paginator"></div>
			</form>
		</div>
			
		<script src="./public/js/editablegrid.js"></script>
		<script src="./public/js/editablegrid_renderers.js" ></script>
		<script src="./public/js/editablegrid_editors.js" ></script>
		<script src="./public/js/editablegrid_validators.js" ></script>
		<script src="./public/js/editablegrid_utils.js" ></script>
		<!--<script src="./public/js/editablegrid_charts.js" ></script>-->
		<script src="./public/js/reliable.js" ></script>		

		<?php require 'dialogs.html'; ?>
	</body>
	
	<script type="text/javascript">
		window.onload = function() {
			
			// load commitments belonging to current user
			commitments = new CommitmentGrid();
			commitments.name = "user_commitments";
			
			load_user_comms = function (horizon, showClosed) {
				if (typeof(horizon) === 'undefined') horizon = (commitments.grid.getCookie('horizon') || 21);
				if (typeof(showClosed)==='undefined') showClosed = (commitments.grid.getCookie('showClosed') || false);
				
				if (showClosed==false) $('#hide_closed').checked = true;
				else $('#hide_closed').checked = falses;
				
				switch (horizon) {
					case 0:
						$('#pill-0').addClass('active');
						$('#pill-7').removeClass('active');
						$('#pill-lookahead').removeClass('active');
						break;
					case 7:
						$('#pill-0').removeClass('active');
						$('#pill-7').addClass('active');
						$('#pill-lookahead').removeClass('active');
						break;
					case 14:
						$('#pill-0').removeClass('active');
						$('#pill-7').removeClass('active');
						$('#pill-lookahead').addClass('active');
						$('#pill-drop').html('Lookahead: 2 wk<span class="caret"></span>');
						break;
					case 21:
						$('#pill-0').removeClass('active');
						$('#pill-7').removeClass('active');
						$('#pill-lookahead').addClass('active');
						$('#pill-drop').html('Lookahead: 3 wk<span class="caret"></span>');
						break;
					case 42:
						$('#pill-0').removeClass('active');
						$('#pill-7').removeClass('active');
						$('#pill-lookahead').addClass('active');
						$('#pill-drop').html('Lookahead: 6 wk<span class="caret"></span>');
					case 'all':
						$('#pill-0').removeClass('active');
						$('#pill-7').removeClass('active');
						$('#pill-lookahead').addClass('active');
						$('#pill-drop').html('Lookahead: all<span class="caret"></span>');
						break;
				}
				
				commitments.grid.setCookie('horizon', horizon);
				commitments.grid.setCookie('showClosed', showClosed);
				
				$.ajax({
					url: '../includes/load_user_commitments.php',
					type: 'POST',
					dataType: "text",
					data: {
						horizon: horizon,
						showClosed: showClosed
					},
					success: function (response) 
					{
						commitments.grid.loadXMLFromString(response); //synchronous function
						commitments.grid.tableLoaded();
						$("#com_total").html('total: <strong>'+commitments.grid.getTotalRowCount()+'</strong>');
					},
					error: function(XMLHttpRequest, textStatus, exception) 
					{ 
						alert("Ajax FAIL!\n" + "\nTextstatus: " + textStatus + "\nException: " + exception); 
					},
					async: true
				});
			};
			
			if (typeof(horizon) === 'undefined') horizon = (commitments.grid.getCookie('horizon') || 21);
			commitments.grid.setCookie('horizon', horizon);
			load_user_comms(horizon);
			weeks = (horizon == 'all') ? 10 : horizon / 7;
			
			$('#comm-horizon-slider').slider({
				min: 0,
				max: 10,
				step: 1,
				range: 'min',
				value: weeks,
				slide: function(event, ui) {
					if (ui.value < 10) $('#comm-horizon-text').html('&nbsp;lookahead: '+ui.value+' weeks');
					else $('#comm-horizon-text').html('&nbsp;lookahead: all');
				},
				change: function( event, ui ) {
					if (ui.value < 10) {
						horizon = ui.value * 7;
						$('#comm-horizon-text').html('&nbsp;lookahead: '+ui.value+' weeks');
					}
					else {
						horizon = 'all';
						$('#comm-horizon-text').html('&nbsp;lookahead: all');
					}
					
					load_user_comms(horizon);
				}
			});
			
			$('#hide-closed').change(function() {
				console.debug(this);
				if (this.checked) load_user_comms(undefined, true);
				else load_user_comms(undefined, false);
			});
			
			requests = new EditableGrid("user_requests", {
				enableSort: true,
				editMode: 'static',
				dateFormat: "US",
				pageSize: 10,
				tableRendered:  function() { 
					updatePaginator(this, "req_paginator"); 
					$("#req_total").html('total: <strong>'+requests.getTotalRowCount()+'</strong>');
				},
				tableLoaded: function() {  
					requests.setCellRenderer('project_number', new CellRenderer({ 
						render: function(cell, value) { 
							cell.innerHTML= "<a title=\"go to project page\" href=\"#\" onclick=\"goto_project_view(\'"+value+"\'); return false;\">"+value+"</a>";
						}
					}));
					this.renderGrid('requests', 'table', 'commitments'); },
				modelChanged: function(rowIndex, columnIndex, oldValue, newValue, row) {
					updateCellValue(this, rowIndex, columnIndex, oldValue, newValue, row);
				}});
			
			$.ajax({
				url: '../includes/load_user_requests.php',
				type: 'POST',
				dataType: "text",
				data: {
					horizon: 21,
				},
				success: function (response) 
				{ //process response as xml, then call tableLoaded
					requests.loadXMLFromString(response); //synchronous function
					requests.tableLoaded();
				},
				error: function(XMLHttpRequest, textStatus, exception) 
				{ 
				alert("Ajax FAIL!\n" + "\nTextstatus: " + textStatus + "\nException: " + exception); 
				},
				async: true
			});
			
			projects = new EditableGrid("Projects", {
				enableSort: true,
				dateFormat: "US",
				pageSize: 5,
				tableRendered:  function() { 
					updatePaginator(this, "projects_paginator"); 
					$("#proj_total").html('total: <strong>'+projects.getTotalRowCount()+'</strong>');
				},
				tableLoaded: function() { 
					projects.setCellRenderer('project_number_2', new CellRenderer({ 
						render: function(cell, value) { 
							cell.innerHTML= "<a title=\"go to project page\" href=\"#\" onclick=\"goto_project_view("+value+"); return false;\">"+value+"</a>";
						}
					}));
					this.renderGrid('user_projects', 'table', 'projects'); }
			}); 
				
			projects.loadXML("../includes/load_user_projects.php");
		}; 
	</script>